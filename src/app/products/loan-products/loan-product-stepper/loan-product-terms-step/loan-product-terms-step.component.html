<form [formGroup]="loanProductTermsForm">

  <div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

    <h4 fxFlex="98%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.Principal'| translate}}</h4>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}}</mat-label>
      <input type="number" matInput formControlName="minPrincipal">
    </mat-form-field>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}}</mat-label>
      <input type="number" matInput formControlName="principal" required>
      <mat-error>
        {{'Product_Component.LoanProduct.LoanStepper.Term.errDefault'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}}</mat-label>
      <input type="number" matInput formControlName="maxPrincipal">
    </mat-form-field>

    <h4 fxFlex="98%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.NumberOfRepayments'| translate}}</h4>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}}</mat-label>
      <input type="number" matInput formControlName="minNumberOfRepayments">
    </mat-form-field>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}}</mat-label>
      <input type="number" matInput formControlName="numberOfRepayments" required>
      <mat-error>
        {{'Product_Component.LoanProduct.LoanStepper.Term.errDefault2'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="31%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}}</mat-label>
      <input type="number" matInput formControlName="maxNumberOfRepayments">
    </mat-form-field>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{'Product_Component.LoanProduct.LoanStepper.Term.InterestRates'| translate}}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="isLinkedToFloatingInterestRates">
      {{'Product_Component.LoanProduct.LoanStepper.Term.isLinkedToFloatingInterestRates'| translate}}
    </mat-checkbox>

    <div *ngIf="!loanProductTermsForm.value.isLinkedToFloatingInterestRates" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <h4 fxFlex="98%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.NominalInterestRate'| translate}}</h4>

      <mat-form-field fxFlex="23%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}}</mat-label>
        <input type="number" matInput formControlName="minInterestRatePerPeriod">
      </mat-form-field>

      <mat-form-field fxFlex="23%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}}</mat-label>
        <input type="number" matInput formControlName="interestRatePerPeriod" required>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.interestRatePerPeriod'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="23%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}}</mat-label>
        <input type="number" matInput formControlName="maxInterestRatePerPeriod">
      </mat-form-field>

      <mat-form-field fxFlex="23%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Frequency'| translate}}</mat-label>
        <mat-select formControlName="interestRateFrequencyType" required>
          <mat-option *ngFor="let interestRateFrequencyType of interestRateFrequencyTypeData" [value]="interestRateFrequencyType.id">
            {{ interestRateFrequencyType.value }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.errinterestRateFrequencyType'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

    </div>

    <div *ngIf="loanProductTermsForm.value.isLinkedToFloatingInterestRates" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column" fxLayoutAlign.gt-sm="start center">

      <h4 fxFlex="98%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.h4'| translate}}</h4>

      <mat-form-field fxFlex="31%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.floatingRatesId'| translate}}</mat-label>
        <mat-select formControlName="floatingRatesId" required>
          <mat-option *ngFor="let floatingRate of floatingRateData" [value]="floatingRate.id">
            {{ floatingRate.name }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.errfloatingRatesId'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="31%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.interestRateDifferential'| translate}}</mat-label>
        <input type="number" matInput formControlName="interestRateDifferential" required>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.errinterestRateDifferential'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-checkbox fxFlex="31%" labelPosition="before" formControlName="isFloatingInterestRateCalculationAllowed">
        {{'Product_Component.LoanProduct.LoanStepper.Term.isFloatingInterestRateCalculationAllowed'| translate}}
      </mat-checkbox>

      <mat-form-field fxFlex="31%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}}</mat-label>
        <input type="number" matInput formControlName="minDifferentialLendingRate" required>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.MinimumInterest'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="31%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}}</mat-label>
        <input type="number" matInput formControlName="defaultDifferentialLendingRate" required>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.DefaultInterest'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="31%">
        <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}}</mat-label>
        <input type="number" matInput formControlName="maxDifferentialLendingRate" required>
        <mat-error>
          {{'Product_Component.LoanProduct.LoanStepper.Term.MaximumInterest'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
        </mat-error>
      </mat-form-field>

    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{'Product_Component.LoanProduct.LoanStepper.Term.Variations'| translate}}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="useBorrowerCycle">
      {{'Product_Component.LoanProduct.LoanStepper.Term.useBorrowerCycle'| translate}}
    </mat-checkbox>

    <div *ngIf="loanProductTermsForm.value.useBorrowerCycle" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <h4 fxFlex="23%" class="mat-h4"> {{'Product_Component.LoanProduct.LoanStepper.Term.h4_2'| translate}}</h4>

      <div fxFlex="73%">
        <button type="button" mat-raised-button color="primary" (click)="addVariationsForBorrowerCycle('Principal', principalVariationsForBorrowerCycle)">
          <fa-icon icon="plus"></fa-icon>&nbsp;&nbsp;
          {{'Product_Component.LoanProduct.LoanStepper.Term.Add'| translate}}
        </button>
      </div>

      <table fxFlex="98%" class="mat-elevation-z1" mat-table [dataSource]="principalVariationsForBorrowerCycle.value" *ngIf="principalVariationsForBorrowerCycle.value.length">

        <ng-container matColumnDef="valueConditionType">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Condition'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.valueConditionType | find:valueConditionTypeData:'id':'value' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="borrowerCycleNumber">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.borrowerCycleNumber'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.borrowerCycleNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="minValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.minValue  }}
          </td>
        </ng-container>

        <ng-container matColumnDef="defaultValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.defaultValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="maxValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.maxValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Actions'| translate}} </th>
          <td mat-cell *matCellDef="let variation; let i = index">
            <button mat-icon-button color="primary" (click)="editVariationsForBorrowerCycle('Principal', principalVariationsForBorrowerCycle, i)">
              <fa-icon icon="edit"></fa-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteVariationsForBorrowerCycle(principalVariationsForBorrowerCycle, i)">
              <fa-icon icon="trash"></fa-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

      <h4 fxFlex="23%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.h4_3'| translate}}</h4>

      <div fxFlex="73%">
        <button type="button" mat-raised-button color="primary" (click)="addVariationsForBorrowerCycle('NumberOfRepayments', numberOfRepaymentVariationsForBorrowerCycle)">
          <fa-icon icon="plus"></fa-icon>&nbsp;&nbsp;
          {{'Product_Component.LoanProduct.LoanStepper.Term.Add'| translate}}
        </button>
      </div>

      <table fxFlex="98%" class="mat-elevation-z1" mat-table [dataSource]="numberOfRepaymentVariationsForBorrowerCycle.value" *ngIf="numberOfRepaymentVariationsForBorrowerCycle.value.length">

        <ng-container matColumnDef="valueConditionType">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Condition'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.valueConditionType | find:valueConditionTypeData:'id':'value' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="borrowerCycleNumber">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.borrowerCycleNumber'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.borrowerCycleNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="minValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.minValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="defaultValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.defaultValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="maxValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.maxValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Actions'| translate}} </th>
          <td mat-cell *matCellDef="let variation; let i = index">
            <button mat-icon-button color="primary" (click)="editVariationsForBorrowerCycle('NumberOfRepayments', numberOfRepaymentVariationsForBorrowerCycle, i)">
              <fa-icon icon="edit"></fa-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteVariationsForBorrowerCycle(numberOfRepaymentVariationsForBorrowerCycle, i)">
              <fa-icon icon="trash"></fa-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

      <h4 fxFlex="23%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.h4_4'| translate}}</h4>

      <div fxFlex="73%">
        <button type="button" mat-raised-button color="primary" (click)="addVariationsForBorrowerCycle('NominalInterestRate', interestRateVariationsForBorrowerCycle)">
          <fa-icon icon="plus"></fa-icon>&nbsp;&nbsp;
          {{'Product_Component.LoanProduct.LoanStepper.Term.Principal'| translate}}Add
        </button>
      </div>

      <table fxFlex="98%" class="mat-elevation-z1" mat-table [dataSource]="interestRateVariationsForBorrowerCycle.value" *ngIf="interestRateVariationsForBorrowerCycle.value.length">

        <ng-container matColumnDef="valueConditionType">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Condition'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.valueConditionType | find:valueConditionTypeData:'id':'value' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="borrowerCycleNumber">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.borrowerCycleNumber'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.borrowerCycleNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="minValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Minimum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.minValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="defaultValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Default'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.defaultValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="maxValue">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Maximum'| translate}} </th>
          <td mat-cell *matCellDef="let variation">
            {{ variation.maxValue }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> {{'Product_Component.LoanProduct.LoanStepper.Term.Actions'| translate}} </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <button mat-icon-button color="primary" (click)="editVariationsForBorrowerCycle('NominalInterestRate', interestRateVariationsForBorrowerCycle, i)">
              <fa-icon icon="edit"></fa-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteVariationsForBorrowerCycle(interestRateVariationsForBorrowerCycle, i)">
              <fa-icon icon="trash"></fa-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h4 fxFlex="98%" class="mat-h4">{{'Product_Component.LoanProduct.LoanStepper.Term.Repaid'| translate}}</h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Frequency'| translate}}</mat-label>
      <input type="number" matInput formControlName="repaymentEvery" required>
      <mat-error>
        {{'Product_Component.LoanProduct.LoanStepper.Term.errRepaid'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.Type'| translate}}</mat-label>
      <mat-select formControlName="repaymentFrequencyType" required>
        <mat-option *ngFor="let repaymentFrequencyType of repaymentFrequencyTypeData" [value]="repaymentFrequencyType.id">
          {{ repaymentFrequencyType.value }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'Product_Component.LoanProduct.LoanStepper.Term.errRepaid2'| translate}}<strong>{{'Product_Component.strongRequired'| translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'Product_Component.LoanProduct.LoanStepper.Term.minimumDaysBetweenDisbursalAndFirstRepayment'| translate}}</mat-label>
      <input type="number" matInput formControlName="minimumDaysBetweenDisbursalAndFirstRepayment">
    </mat-form-field>

  </div>

  <div fxLayout="row" class="margin-t" fxLayout.xs="column" fxLayoutAlign="center" fxLayoutGap="2%">
    <button mat-raised-button matStepperPrevious>
      <fa-icon icon="arrow-left"></fa-icon>&nbsp;&nbsp;
      {{ "ShareButton.PreviousEng" | translate }}
    </button>
    <button mat-raised-button matStepperNext>
      {{ "ShareButton.NextEng" | translate }}&nbsp;&nbsp;
      <fa-icon icon="arrow-right"></fa-icon>
    </button>
  </div>

</form>

<mat-card class="loan-card">

  <mat-card-header fxLayout="column" class="header">

	<mat-card-title-group class="header-title-group">

	<div class="profile-image-container">
		<div>
			<img mat-card-md-image class="profile-image" matTooltip="Loans Account"
				[src]="'assets/images/loans_account_placeholder.png'">
		</div>
	</div>

	  <div class="mat-typography loan-card-title">
	    <mat-card-title>
		  <div fxLayout="row" fxLayout.lt-md="column">

			<div fxFlex="50%">
				<h3>
				  <i class="fa fa-stop" matTooltip="{{ loanDetailsData.status.value }}" [ngClass]="loanDetailsData.inArrears?'status-active-overdue':(loanDetailsData.status.code|statusLookup)"></i>
				  {{'Loans.View.Account.loanProductName'| translate }}{{loanDetailsData.loanProductName}}(#{{loanDetailsData.accountNo}})
				  <br/>
				  <span *ngIf="loanDetailsData.clientName" > {{'Loans.View.Account.clientName'| translate }} {{loanDetailsData.clientName}} </span> <br/>
				  <span *ngIf="loanDetailsData.group" > {{'Loans.View.Account.groupName'| translate }} {{loanDetailsData.group.name}} </span>
				</h3>
			</div>

			<div *ngIf="loanDetailsData.summary" class="loansOverview mat-typography" fxFlex="50%">
			  <h3> {{'Loans.View.Account.h3'| translate }} </h3>
				<span>{{'Loans.View.Account.totalOutstanding'| translate }}{{loanDetailsData.currency.displaySymbol}} {{loanDetailsData.summary.totalOutstanding | number}}</span><br>
				  <span>{{'Loans.View.Account.totalOverdue'| translate }}{{loanDetailsData.summary.totalOverdue | number}}
				  <span *ngIf="!(loanDetailsData.summary.totalOverdue>=0)">{{'Loans.View.Account.NotProvided'| translate }}</span>
				</span><br>
			</div>

		  </div>
		</mat-card-title>
	  </div>
	</mat-card-title-group>

	<mat-card-actions class="loan-actions">

	  <ng-container *ngFor="let item of buttonConfig.singleButtons" class="loan-span">
		<button mat-raised-button *midasHasPermission="item.taskPermissionName" (click)="loanAction(item.name)">
		  <i class="{{item.icon}}"></i> {{item.name}} </button>
	  </ng-container>

	  <ng-container *ngIf="buttonConfig.options.length" class="loan-span">
		<button mat-raised-button [matMenuTriggerFor]="More">{{'Loans.View.Account.More'| translate }}</button>
		  <mat-menu #More="matMenu">
			<span *ngFor="let item of buttonConfig.options">
			  <button mat-menu-item *midasHasPermission="item.taskPermissionName" (click)="loanAction(item.name)">{{item.name}}</button>
			</span>
		  </mat-menu>
	  </ng-container>

	</mat-card-actions>

  </mat-card-header>

  <mat-card-content>
    <nav mat-tab-nav-bar class="navigation-tabs">
  	  <a mat-tab-link [routerLink]="['./general']" routerLinkActive #general="routerLinkActive" [active]="general.isActive">
        {{'Loans.View.general'| translate }}
	  </a>
	  <a mat-tab-link [routerLink]="['./accountdetail']" routerLinkActive #accountdetail="routerLinkActive" [active]="accountdetail.isActive">
      {{'Loans.View.accountdetail'| translate }}
	  </a>
	  <ng-container *ngIf="loanDetailsData.originalSchedule">
		<a mat-tab-link [routerLink]="['./original-schedule']" routerLinkActive #originalSchedule="routerLinkActive" [active]="originalSchedule.isActive">
		  {{'Loans.View.originalSchedule'| translate }}
		</a>
	  </ng-container>
	  <a mat-tab-link [routerLink]="['./repayment-schedule']" routerLinkActive #repaymentSchedule="routerLinkActive" [active]="repaymentSchedule.isActive">
      {{'Loans.View.repaymentSchedule'| translate }}
	  </a>
	  <ng-container *ngIf="loanDetailsData.transactions">
		<a mat-tab-link [routerLink]="['./transactions']" routerLinkActive #transactions="routerLinkActive" [active]="transactions.isActive">
		  {{'Loans.View.transactions'| translate }}
		</a>
	  </ng-container>
	  <ng-container *ngIf="loanDetailsData.collateral">
		<a mat-tab-link [routerLink]="['./loan-collateral']" routerLinkActive #loanCollateralDetails="routerLinkActive"
	  	  [active]="loanCollateralDetails.isActive">
	      {{'Loans.View.loanCollateralDetails'| translate }}
		</a>
	  </ng-container>
	  <ng-container *ngIf="loanDetailsData.multiDisburseLoan">
		<a mat-tab-link [routerLink]="['./loan-tranche-details']" routerLinkActive #loanTrancheDetails="routerLinkActive" [active]="loanTrancheDetails.isActive">
		  {{'Loans.View.loanTrancheDetails'| translate }}
		</a>
      </ng-container>
	  <ng-container *ngIf="loanDetailsData.overdueCharges.length > 0">
		<a mat-tab-link [routerLink]="['./overdue-charges']" routerLinkActive #overduecharges="routerLinkActive" [active]="overduecharges.isActive">
			{{'Loans.View.loanProductName'| translate }}
		</a>
	  </ng-container>
	  <ng-container *ngIf="loanDetailsData.isLoanProductLinkedToFloatingRate">
		<a mat-tab-link [routerLink]="['./floating-interest-rates']" routerLinkActive #floatingInterestRates="routerLinkActive" [active]="floatingInterestRates.isActive">
			{{'Loans.View.floatingInterestRates'| translate }}
		</a>
	  </ng-container>
	  <ng-container *ngIf="loanDetailsData.charges">
		<a mat-tab-link [routerLink]="['./charges']" routerLinkActive #charges="routerLinkActive" [active]="charges.isActive">
		  {{'Loans.View.charges'| translate }}
		</a>
	  </ng-container>
		<a mat-tab-link [routerLink]="['./loan-documents']" routerLinkActive #loanDocuments="routerLinkActive" [active]="loanDocuments.isActive">
			{{'Loans.View.loanProductName'| translate }}
		</a>
	  <a mat-tab-link *midasHasPermission="'READ_LOANNOTE'" [routerLink]="['./notes']" routerLinkActive #notes="routerLinkActive" [active]="notes.isActive">
      {{'Loans.View.Notes'| translate }}
	  </a>
	<ng-container *ngIf="loanDetailsData.clientId">
		<a mat-tab-link [routerLink]="['./standing-instruction']" routerLinkActive #standingInstruction="routerLinkActive"
			[active]="standingInstruction.isActive">
			{{'Loans.View.standingInstruction'| translate }}
		</a>
	</ng-container>
	  <ng-container *ngFor="let loanDatatable of loanDatatables">
        <a mat-tab-link *midasHasPermission="'READ_' + loanDatatable.registeredTableName" [routerLink]="['./datatables',loanDatatable.registeredTableName]"
          routerLinkActive #datatable="routerLinkActive" [active]="datatable.isActive">
          {{loanDatatable.registeredTableName}}
        </a>
      </ng-container>
    </nav>
    <router-outlet></router-outlet>
  </mat-card-content>

</mat-card>
